# MCPæ¥å£éªŒè¯ç»„ä»¶ - æŠ€æœ¯æ–‡æ¡£

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCPæ¥å£éªŒè¯ç»„ä»¶                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AIå·¥å…·é€‚é…å±‚ (Cursor, Windsurf, Trae, Augment, Claude)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 MCPåè®®æœåŠ¡å™¨                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ JSON-RPC 2.0â”‚ â”‚ WebSocket   â”‚ â”‚ ä¼šè¯ç®¡ç†     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æ™ºèƒ½çº¦æŸç³»ç»Ÿ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ çº¦æŸç®¡ç†å™¨   â”‚ â”‚ æ¨¡æ¿å¼•æ“     â”‚ â”‚ æŒ‡ä»¤å¢å¼ºå™¨   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æ ¸å¿ƒéªŒè¯å¼•æ“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ä»£ç è§£æå™¨   â”‚ â”‚ å·®å¼‚åˆ†æå™¨   â”‚ â”‚ éªŒè¯å¼•æ“     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 æ•°æ®å­˜å‚¨å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ SQLiteæ•°æ®åº“â”‚ â”‚ éªŒè¯å†å²     â”‚ â”‚ é…ç½®ç®¡ç†     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. MCPåè®®æœåŠ¡å™¨ (`src/core/mcp-server/`)

**ä¸»è¦èŒè´£ï¼š**
- å®ç°MCPæ ‡å‡†çš„JSON-RPC 2.0é€šä¿¡åè®®
- ç®¡ç†ä¸AIå·¥å…·çš„è¿æ¥å’Œä¼šè¯
- å¤„ç†å·¥å…·æ³¨å†Œå’Œèµ„æºç®¡ç†

**æ ¸å¿ƒç±»ï¼š**
```typescript
class MCPServer {
  private transport: Transport;
  private toolRegistry: ToolRegistry;
  private sessionManager: SessionManager;
  
  async start(): Promise<void>
  async stop(): Promise<void>
  async handleRequest(request: JSONRPCRequest): Promise<JSONRPCResponse>
}
```

**å…³é”®ç‰¹æ€§ï¼š**
- æ”¯æŒstdioå’ŒWebSocketä¼ è¾“
- è‡ªåŠ¨ä¼šè¯æ¸…ç†æœºåˆ¶
- å·¥å…·åŠ¨æ€æ³¨å†Œ
- é”™è¯¯æ¢å¤å’Œé‡è¯•

### 2. æ™ºèƒ½çº¦æŸç³»ç»Ÿ (`src/core/intelligent-constraints/`)

**æ¶æ„ç»„ä»¶ï¼š**

#### çº¦æŸç®¡ç†å™¨ (ConstraintManager)
```typescript
class ConstraintManager {
  private activeConstraints: Map<string, Constraint>;
  private sessionState: SessionState;
  
  async activateConstraints(projectPath: string): Promise<void>
  async applyConstraints(code: string): Promise<ConstraintResult>
  async deactivateConstraints(): Promise<void>
}
```

#### æ¨¡æ¿å¼•æ“ (ConstraintTemplateEngine)
```typescript
class ConstraintTemplateEngine {
  private templates: Map<string, Template>;
  
  generateConstraintPrompt(context: ProjectContext): string
  loadTemplate(name: string): Template
  renderTemplate(template: Template, data: any): string
}
```

#### æŒ‡ä»¤å¢å¼ºå™¨ (InstructionEnhancer)
```typescript
class InstructionEnhancer {
  detectUseInterfaceInstruction(input: string): boolean
  analyzeUserIntent(instruction: string): UserIntent
  enhanceInstruction(instruction: string, context: ProjectContext): string
}
```

### 3. éªŒè¯å¼•æ“ (`src/core/validation/`)

**éªŒè¯æµç¨‹ï¼š**
```
è¾“å…¥ä»£ç  â†’ ä»£ç è§£æ â†’ æ¥å£æå– â†’ è§„èŒƒæ¯”è¾ƒ â†’ å·®å¼‚åˆ†æ â†’ éªŒè¯æŠ¥å‘Š
```

**æ ¸å¿ƒç»„ä»¶ï¼š**

#### ä»£ç è§£æå™¨ (CodeParser)
```typescript
class CodeParser {
  parseTypeScript(code: string): ParseResult
  parseJavaScript(code: string): ParseResult
  parsePython(code: string): ParseResult
  extractAPIDefinitions(ast: AST): APIDefinition[]
}
```

#### å·®å¼‚åˆ†æå™¨ (DiffAnalyzer)
```typescript
class DiffAnalyzer {
  compareInterfaces(frontend: Interface[], backend: Interface[]): DiffResult
  detectMismatches(diff: DiffResult): Mismatch[]
  generateSuggestions(mismatches: Mismatch[]): Suggestion[]
}
```

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### æ ¸å¿ƒæ•°æ®ç»“æ„

#### éªŒè¯ç»“æœ (ValidationResult)
```typescript
interface ValidationResult {
  id: string;
  timestamp: Date;
  projectPath: string;
  endpoint: string;
  method: HTTPMethod;
  status: 'success' | 'warning' | 'error';
  errors: ValidationError[];
  warnings: ValidationWarning[];
  suggestions: Suggestion[];
  metadata: ValidationMetadata;
}
```

#### çº¦æŸé…ç½® (ConstraintConfig)
```typescript
interface ConstraintConfig {
  template: string;
  strictMode: boolean;
  rules: {
    requireDocumentation: boolean;
    enforceNaming: NamingConvention;
    validateTypes: boolean;
    checkSecurity: boolean;
  };
  customRules: CustomRule[];
}
```

#### é¡¹ç›®ä¸Šä¸‹æ–‡ (ProjectContext)
```typescript
interface ProjectContext {
  projectPath: string;
  openApiSpec?: OpenAPISpec;
  packageJson?: PackageJson;
  tsConfig?: TSConfig;
  gitInfo?: GitInfo;
  dependencies: Dependency[];
}
```

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### æ’ä»¶æ¶æ„

```typescript
interface Plugin {
  name: string;
  version: string;
  dependencies?: string[];
  
  hooks: {
    beforeValidation?: (context: ValidationContext) => Promise<void>;
    afterValidation?: (context: ValidationContext, result: ValidationResult) => Promise<void>;
    onError?: (error: Error, context: ValidationContext) => Promise<void>;
  };
  
  tools?: {
    [toolName: string]: ToolDefinition;
  };
  
  initialize?: (config: PluginConfig) => Promise<void>;
  cleanup?: () => Promise<void>;
}
```

### æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

```
åŠ è½½æ’ä»¶ â†’ ä¾èµ–æ£€æŸ¥ â†’ åˆå§‹åŒ– â†’ æ³¨å†Œé’©å­ â†’ æ³¨å†Œå·¥å…· â†’ è¿è¡Œæ—¶è°ƒç”¨ â†’ æ¸…ç†
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥

**å¤šå±‚ç¼“å­˜æ¶æ„ï¼š**
```typescript
class CacheManager {
  private memoryCache: Map<string, CacheEntry>;
  private fileCache: FileCache;
  private redisCache?: RedisCache;
  
  async get<T>(key: string): Promise<T | null>
  async set<T>(key: string, value: T, ttl?: number): Promise<void>
  async invalidate(pattern: string): Promise<void>
}
```

**ç¼“å­˜å±‚çº§ï¼š**
1. **å†…å­˜ç¼“å­˜** - çƒ­ç‚¹æ•°æ®ï¼Œæ¯«ç§’çº§è®¿é—®
2. **æ–‡ä»¶ç¼“å­˜** - æŒä¹…åŒ–ç¼“å­˜ï¼Œç§’çº§è®¿é—®
3. **Redisç¼“å­˜** - åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

### 2. å¹¶å‘å¤„ç†

**å·¥ä½œæ± æ¨¡å¼ï¼š**
```typescript
class WorkerPool {
  private workers: Worker[];
  private taskQueue: Task[];
  private maxConcurrency: number;
  
  async execute<T>(task: Task): Promise<T>
  async executeBatch<T>(tasks: Task[]): Promise<T[]>
}
```

### 3. å¢é‡éªŒè¯

**å˜æ›´æ£€æµ‹ï¼š**
```typescript
class IncrementalValidator {
  private changeDetector: ChangeDetector;
  private dependencyGraph: DependencyGraph;
  
  async validateChanges(since: string): Promise<ValidationResult[]>
  private buildDependencyGraph(): DependencyGraph
  private detectAffectedFiles(changes: FileChange[]): string[]
}
```

## ğŸ”’ å®‰å…¨æœºåˆ¶

### 1. è®¿é—®æ§åˆ¶

```typescript
class SecurityManager {
  private accessControl: AccessControl;
  private rateLimiter: RateLimiter;
  
  async authenticate(token: string): Promise<User>
  async authorize(user: User, resource: string, action: string): Promise<boolean>
  async checkRateLimit(user: User): Promise<boolean>
}
```

### 2. æ•°æ®ä¿æŠ¤

**æ•æ„Ÿæ•°æ®å¤„ç†ï¼š**
- APIå¯†é’¥åŠ å¯†å­˜å‚¨
- ä»£ç å†…å®¹è„±æ•
- å®¡è®¡æ—¥å¿—è®°å½•
- æ•°æ®ä¼ è¾“åŠ å¯†

### 3. æ²™ç®±æ‰§è¡Œ

```typescript
class SandboxExecutor {
  private vm: VM;
  private timeout: number;
  private memoryLimit: number;
  
  async executeCode(code: string, context: ExecutionContext): Promise<ExecutionResult>
  private createSecureContext(): ExecutionContext
}
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. æŒ‡æ ‡æ”¶é›†

```typescript
class MetricsCollector {
  private metrics: Map<string, Metric>;
  
  incrementCounter(name: string, tags?: Tags): void
  recordHistogram(name: string, value: number, tags?: Tags): void
  recordGauge(name: string, value: number, tags?: Tags): void
}
```

**å…³é”®æŒ‡æ ‡ï¼š**
- éªŒè¯è¯·æ±‚æ•°é‡å’Œå»¶è¿Ÿ
- é”™è¯¯ç‡å’ŒæˆåŠŸç‡
- ç¼“å­˜å‘½ä¸­ç‡
- å†…å­˜å’ŒCPUä½¿ç”¨ç‡

### 2. ç»“æ„åŒ–æ—¥å¿—

```typescript
class Logger {
  info(message: string, context?: LogContext): void
  warn(message: string, context?: LogContext): void
  error(message: string, error?: Error, context?: LogContext): void
  debug(message: string, context?: LogContext): void
}
```

## ğŸ”„ é”™è¯¯æ¢å¤

### é”™è¯¯æ¢å¤ç­–ç•¥

```typescript
class ErrorRecoverySystem {
  private retryPolicy: RetryPolicy;
  private circuitBreaker: CircuitBreaker;
  private fallbackHandler: FallbackHandler;
  
  async executeWithRecovery<T>(operation: () => Promise<T>): Promise<T>
  private shouldRetry(error: Error, attempt: number): boolean
  private getFallbackResult<T>(error: Error): T
}
```

**æ¢å¤æœºåˆ¶ï¼š**
1. **é‡è¯•ç­–ç•¥** - æŒ‡æ•°é€€é¿é‡è¯•
2. **ç†”æ–­å™¨** - é˜²æ­¢çº§è”å¤±è´¥
3. **é™çº§å¤„ç†** - æä¾›å¤‡ç”¨æ–¹æ¡ˆ
4. **çŠ¶æ€æ¢å¤** - è‡ªåŠ¨çŠ¶æ€å›æ»š

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
E2Eæµ‹è¯• (10%) - å®Œæ•´å·¥ä½œæµæµ‹è¯•
é›†æˆæµ‹è¯• (20%) - æ¨¡å—é—´äº¤äº’æµ‹è¯•  
å•å…ƒæµ‹è¯• (70%) - å•ä¸ªå‡½æ•°/ç±»æµ‹è¯•
```

### æµ‹è¯•å·¥å…·é“¾

- **Jest** - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **Supertest** - APIæµ‹è¯•
- **Puppeteer** - E2Eæµ‹è¯•
- **Mock Service Worker** - APIæ¨¡æ‹Ÿ

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```typescript
class ClusterManager {
  private nodes: ClusterNode[];
  private loadBalancer: LoadBalancer;
  
  async addNode(node: ClusterNode): Promise<void>
  async removeNode(nodeId: string): Promise<void>
  async distributeLoad(request: Request): Promise<ClusterNode>
}
```

### å¾®æœåŠ¡æ¶æ„

```
APIç½‘å…³ â†’ éªŒè¯æœåŠ¡ â†’ è§£ææœåŠ¡ â†’ å­˜å‚¨æœåŠ¡
        â†’ çº¦æŸæœåŠ¡ â†’ æŠ¥å‘ŠæœåŠ¡ â†’ é€šçŸ¥æœåŠ¡
```

---

## ğŸ”§ å¼€å‘ç¯å¢ƒè®¾ç½®

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd mcp-interface-validator

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œæµ‹è¯•
npm test

# æ„å»ºé¡¹ç›®
npm run build
```

### è°ƒè¯•é…ç½®

VS Code `.vscode/launch.json`:
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug MCP Server",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/src/index.ts",
      "env": {
        "NODE_ENV": "development",
        "DEBUG": "mcp:*"
      }
    }
  ]
}
```

## ğŸ”„ æ•°æ®æµæ¶æ„

### éªŒè¯è¯·æ±‚å¤„ç†æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ MCPæœåŠ¡å™¨ â†’ è¯·æ±‚è·¯ç”± â†’ å·¥å…·æ‰§è¡Œ â†’ ç»“æœå¤„ç† â†’ å“åº”è¿”å›
    â†“           â†“           â†“           â†“           â†“           â†“
AIå·¥å…·è°ƒç”¨ â†’ JSON-RPC â†’ å‚æ•°éªŒè¯ â†’ æ ¸å¿ƒé€»è¾‘ â†’ ç»“æœæ ¼å¼åŒ– â†’ å®¢æˆ·ç«¯æ¥æ”¶
```

### æ™ºèƒ½çº¦æŸå¤„ç†æµç¨‹

```
.use interfaceæŒ‡ä»¤ â†’ æŒ‡ä»¤æ£€æµ‹ â†’ æ„å›¾åˆ†æ â†’ ä¸Šä¸‹æ–‡åŠ è½½ â†’ çº¦æŸç”Ÿæˆ â†’ æŒ‡ä»¤å¢å¼º
        â†“               â†“           â†“           â†“           â†“           â†“
    ç”¨æˆ·è¾“å…¥ â†’ InstructionEnhancer â†’ UserIntent â†’ ProjectContext â†’ Constraints â†’ EnhancedInstruction
```

### ä»£ç éªŒè¯æµç¨‹

```
ä»£ç è¾“å…¥ â†’ è¯­è¨€æ£€æµ‹ â†’ ASTè§£æ â†’ æ¥å£æå– â†’ è§„èŒƒæ¯”è¾ƒ â†’ å·®å¼‚åˆ†æ â†’ éªŒè¯æŠ¥å‘Š
    â†“           â†“           â†“           â†“           â†“           â†“           â†“
æºä»£ç æ–‡ä»¶ â†’ CodeParser â†’ è¯­æ³•æ ‘ â†’ APIå®šä¹‰ â†’ OpenAPIè§„èŒƒ â†’ DiffAnalyzer â†’ ValidationResult
```

## ğŸ—ƒï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### validation_results è¡¨
```sql
CREATE TABLE validation_results (
    id TEXT PRIMARY KEY,
    timestamp DATETIME NOT NULL,
    project_path TEXT NOT NULL,
    endpoint TEXT,
    method TEXT,
    status TEXT NOT NULL CHECK (status IN ('success', 'warning', 'error')),
    errors TEXT, -- JSON array
    warnings TEXT, -- JSON array
    suggestions TEXT, -- JSON array
    metadata TEXT, -- JSON object
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_validation_results_timestamp ON validation_results(timestamp);
CREATE INDEX idx_validation_results_project ON validation_results(project_path);
CREATE INDEX idx_validation_results_status ON validation_results(status);
```

#### constraint_sessions è¡¨
```sql
CREATE TABLE constraint_sessions (
    session_id TEXT PRIMARY KEY,
    project_path TEXT NOT NULL,
    template TEXT NOT NULL,
    config TEXT NOT NULL, -- JSON object
    active BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    expires_at DATETIME,
    last_used DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_constraint_sessions_project ON constraint_sessions(project_path);
CREATE INDEX idx_constraint_sessions_active ON constraint_sessions(active);
```

#### project_configs è¡¨
```sql
CREATE TABLE project_configs (
    project_path TEXT PRIMARY KEY,
    openapi_spec_path TEXT,
    config TEXT NOT NULL, -- JSON object
    auto_detected TEXT, -- JSON object
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ”Œ æ’ä»¶å¼€å‘æŒ‡å—

### æ’ä»¶æ¥å£å®šä¹‰

```typescript
interface PluginInterface {
  // æ’ä»¶å…ƒæ•°æ®
  readonly metadata: PluginMetadata;

  // ç”Ÿå‘½å‘¨æœŸé’©å­
  initialize?(config: PluginConfig): Promise<void>;
  activate?(): Promise<void>;
  deactivate?(): Promise<void>;
  cleanup?(): Promise<void>;

  // éªŒè¯é’©å­
  beforeValidation?(context: ValidationContext): Promise<ValidationContext>;
  afterValidation?(context: ValidationContext, result: ValidationResult): Promise<ValidationResult>;
  onValidationError?(error: Error, context: ValidationContext): Promise<void>;

  // çº¦æŸé’©å­
  beforeConstraintApplication?(instruction: string, context: ProjectContext): Promise<string>;
  afterConstraintApplication?(enhancedInstruction: string, context: ProjectContext): Promise<string>;

  // è‡ªå®šä¹‰å·¥å…·
  tools?: { [toolName: string]: ToolHandler };

  // é…ç½®éªŒè¯
  validateConfig?(config: any): Promise<ConfigValidationResult>;
}
```

### æ’ä»¶ç¤ºä¾‹

```typescript
// plugins/custom-validator/index.ts
export class CustomValidatorPlugin implements PluginInterface {
  readonly metadata: PluginMetadata = {
    name: 'custom-validator',
    version: '1.0.0',
    description: 'è‡ªå®šä¹‰éªŒè¯è§„åˆ™æ’ä»¶',
    author: 'Your Team',
    dependencies: ['@openapi/validator']
  };

  async initialize(config: PluginConfig): Promise<void> {
    console.log('åˆå§‹åŒ–è‡ªå®šä¹‰éªŒè¯å™¨æ’ä»¶');
    // åˆå§‹åŒ–é€»è¾‘
  }

  async beforeValidation(context: ValidationContext): Promise<ValidationContext> {
    // åœ¨éªŒè¯å‰æ·»åŠ è‡ªå®šä¹‰æ£€æŸ¥
    context.customRules = await this.loadCustomRules(context.projectPath);
    return context;
  }

  async afterValidation(
    context: ValidationContext,
    result: ValidationResult
  ): Promise<ValidationResult> {
    // åœ¨éªŒè¯åæ·»åŠ è‡ªå®šä¹‰å»ºè®®
    result.suggestions.push(...await this.generateCustomSuggestions(result));
    return result;
  }

  tools = {
    'custom-validate': async (params: any) => {
      // è‡ªå®šä¹‰éªŒè¯å·¥å…·å®ç°
      return { success: true, result: 'Custom validation completed' };
    }
  };

  private async loadCustomRules(projectPath: string): Promise<CustomRule[]> {
    // åŠ è½½é¡¹ç›®ç‰¹å®šçš„è‡ªå®šä¹‰è§„åˆ™
    return [];
  }

  private async generateCustomSuggestions(result: ValidationResult): Promise<Suggestion[]> {
    // ç”Ÿæˆè‡ªå®šä¹‰æ”¹è¿›å»ºè®®
    return [];
  }
}
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### å•æœºéƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'
services:
  mcp-validator:
    image: mcp-interface-validator:latest
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=sqlite:///data/validator.db
    volumes:
      - ./data:/app/data
      - ./config:/app/config
    restart: unless-stopped
```

### é›†ç¾¤éƒ¨ç½²

```yaml
# kubernetes/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mcp-validator
spec:
  replicas: 3
  selector:
    matchLabels:
      app: mcp-validator
  template:
    metadata:
      labels:
        app: mcp-validator
    spec:
      containers:
      - name: mcp-validator
        image: mcp-interface-validator:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

### è´Ÿè½½å‡è¡¡é…ç½®

```nginx
# nginx.conf
upstream mcp_validator {
    least_conn;
    server mcp-validator-1:3000;
    server mcp-validator-2:3000;
    server mcp-validator-3:3000;
}

server {
    listen 80;
    server_name validator.example.com;

    location / {
        proxy_pass http://mcp_validator;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocketæ”¯æŒ
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## ğŸ“Š ç›‘æ§å’Œå¯è§‚æµ‹æ€§

### æŒ‡æ ‡å®šä¹‰

```typescript
interface SystemMetrics {
  // æ€§èƒ½æŒ‡æ ‡
  performance: {
    requestLatency: HistogramMetric;
    requestThroughput: CounterMetric;
    errorRate: GaugeMetric;
    cacheHitRate: GaugeMetric;
  };

  // ä¸šåŠ¡æŒ‡æ ‡
  business: {
    validationCount: CounterMetric;
    validationSuccessRate: GaugeMetric;
    constraintApplicationCount: CounterMetric;
    activeProjects: GaugeMetric;
  };

  // ç³»ç»ŸæŒ‡æ ‡
  system: {
    memoryUsage: GaugeMetric;
    cpuUsage: GaugeMetric;
    diskUsage: GaugeMetric;
    connectionCount: GaugeMetric;
  };
}
```

### Prometheusé…ç½®

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'mcp-validator'
    static_configs:
      - targets: ['localhost:3000']
    metrics_path: '/metrics'
    scrape_interval: 10s
```

### Grafanaä»ªè¡¨æ¿

```json
{
  "dashboard": {
    "title": "MCPæ¥å£éªŒè¯ç»„ä»¶ç›‘æ§",
    "panels": [
      {
        "title": "è¯·æ±‚å»¶è¿Ÿ",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, mcp_request_duration_seconds_bucket)",
            "legendFormat": "95th percentile"
          }
        ]
      },
      {
        "title": "éªŒè¯æˆåŠŸç‡",
        "type": "stat",
        "targets": [
          {
            "expr": "mcp_validation_success_rate",
            "legendFormat": "Success Rate"
          }
        ]
      }
    ]
  }
}
```

è¿™ä¸ªæŠ€æœ¯æ–‡æ¡£æä¾›äº†ç³»ç»Ÿçš„å®Œæ•´æŠ€æœ¯è§†å›¾ï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æ ¸å¿ƒæ¨¡å—ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æœºåˆ¶ã€æ’ä»¶å¼€å‘ã€éƒ¨ç½²æ¶æ„å’Œç›‘æ§ç­‰å…³é”®æŠ€æœ¯ç»†èŠ‚ã€‚
