# ğŸ§  æ™ºèƒ½çº¦æŸç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æ™ºèƒ½çº¦æŸç³»ç»Ÿä¸ºMCPæ¥å£éªŒè¯ç»„ä»¶æ·»åŠ äº†`.use interface`æŒ‡ä»¤åŠŸèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ‹¦æˆªç”¨æˆ·è¾“å…¥å¹¶æ³¨å…¥æ¥å£éªŒè¯çº¦æŸæç¤ºè¯ï¼Œç¡®ä¿AIç”Ÿæˆç¬¦åˆOpenAPIè§„èŒƒçš„é«˜è´¨é‡ä»£ç ã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### 1. ç³»ç»Ÿç»„ä»¶å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ™ºèƒ½çº¦æŸç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æŒ‡ä»¤æ£€æµ‹å™¨      â”‚  â”‚  çº¦æŸç®¡ç†å™¨      â”‚  â”‚  æ¨¡æ¿å¼•æ“        â”‚ â”‚
â”‚  â”‚ InstructionDet  â”‚  â”‚ ConstraintMgr   â”‚  â”‚ TemplateEngine  â”‚ â”‚
â”‚  â”‚ ector           â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                     â”‚                     â”‚        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                 â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æŒ‡ä»¤å¢å¼ºå™¨      â”‚  â”‚  ä¸Šä¸‹æ–‡æ³¨å…¥å™¨    â”‚  â”‚  ä¼šè¯ç®¡ç†å™¨      â”‚ â”‚
â”‚  â”‚ InstructionEnh  â”‚  â”‚ ContextInjector â”‚  â”‚ SessionManager  â”‚ â”‚
â”‚  â”‚ ancer           â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MCPå·¥å…·æ¥å£                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ activate-interface-constraints                              â”‚
â”‚  â€¢ apply-interface-constraints                                 â”‚
â”‚  â€¢ validate-interface (å¢å¼ºç‰ˆ)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥: ".use interface å¼€å‘èŠå¤©åŠŸèƒ½"
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   æŒ‡ä»¤æ£€æµ‹å™¨     â”‚ â”€â”€â”€â”€ æ£€æµ‹ .use interface
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   çº¦æŸç®¡ç†å™¨     â”‚ â”€â”€â”€â”€ æ¿€æ´»çº¦æŸæ¨¡å¼
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   æ¨¡æ¿å¼•æ“       â”‚ â”€â”€â”€â”€ ç”Ÿæˆçº¦æŸæç¤ºè¯
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   æŒ‡ä»¤å¢å¼ºå™¨     â”‚ â”€â”€â”€â”€ åˆå¹¶ç”¨æˆ·æŒ‡ä»¤+çº¦æŸ
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   è¿”å›å¢å¼ºæŒ‡ä»¤   â”‚ â”€â”€â”€â”€ ä¾›ç”¨æˆ·ä½¿ç”¨
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. InstructionDetector (æŒ‡ä»¤æ£€æµ‹å™¨)

**èŒè´£**ï¼š
- æ£€æµ‹ç”¨æˆ·è¾“å…¥ä¸­çš„ `.use interface` æŒ‡ä»¤
- æ”¯æŒä¸­è‹±æ–‡æŒ‡ä»¤å˜ä½“
- æå–ç”¨æˆ·çš„å®é™…éœ€æ±‚å†…å®¹

**æ¥å£è®¾è®¡**ï¼š
```typescript
interface InstructionDetector {
  detectConstraintCommand(input: string): ConstraintCommand | null;
  extractUserInstruction(input: string): string;
  getSupportedCommands(): string[];
}

interface ConstraintCommand {
  command: string;           // ".use interface"
  userInstruction: string;   // "å¼€å‘èŠå¤©åŠŸèƒ½"
  options?: any;            // å¯é€‰å‚æ•°
}
```

### 2. ConstraintManager (çº¦æŸç®¡ç†å™¨)

**èŒè´£**ï¼š
- ç®¡ç†çº¦æŸæ¨¡å¼çš„æ¿€æ´»çŠ¶æ€
- ç»´æŠ¤ä¼šè¯çº§åˆ«çš„çº¦æŸé…ç½®
- æä¾›çº¦æŸçŠ¶æ€æŸ¥è¯¢å’Œæ§åˆ¶

**æ¥å£è®¾è®¡**ï¼š
```typescript
interface ConstraintManager {
  activateConstraints(sessionId: string, config?: ConstraintConfig): void;
  deactivateConstraints(sessionId: string): void;
  isConstraintActive(sessionId: string): boolean;
  getConstraintConfig(sessionId: string): ConstraintConfig | null;
  updateConstraintConfig(sessionId: string, config: ConstraintConfig): void;
}

interface ConstraintConfig {
  templateType: 'default' | 'strict' | 'custom';
  language: 'zh' | 'en' | 'auto';
  includeProjectContext: boolean;
  customRules?: string[];
}
```

### 3. ConstraintTemplateEngine (çº¦æŸæ¨¡æ¿å¼•æ“)

**èŒè´£**ï¼š
- ç”Ÿæˆçº¦æŸæç¤ºè¯æ¨¡æ¿
- æ”¯æŒé¡¹ç›®ä¸Šä¸‹æ–‡æ³¨å…¥
- æä¾›å¤šè¯­è¨€æ¨¡æ¿æ”¯æŒ

**æ¥å£è®¾è®¡**ï¼š
```typescript
interface ConstraintTemplateEngine {
  generateConstraintPrompt(
    userIntent: UserIntent,
    projectContext: ProjectContext,
    config: ConstraintConfig
  ): string;
  
  getAvailableTemplates(): TemplateInfo[];
  registerCustomTemplate(name: string, template: ConstraintTemplate): void;
}

interface ConstraintTemplate {
  name: string;
  language: 'zh' | 'en';
  content: string;
  variables: string[];
  priority: number;
}
```

### 4. InstructionEnhancer (æŒ‡ä»¤å¢å¼ºå™¨)

**èŒè´£**ï¼š
- åˆ†æç”¨æˆ·æŒ‡ä»¤æ„å›¾
- åˆå¹¶ç”¨æˆ·æŒ‡ä»¤å’Œçº¦æŸæç¤ºè¯
- ç”Ÿæˆæœ€ç»ˆçš„å¢å¼ºæŒ‡ä»¤

**æ¥å£è®¾è®¡**ï¼š
```typescript
interface InstructionEnhancer {
  enhanceInstruction(
    userInstruction: string,
    constraintPrompt: string,
    options?: EnhanceOptions
  ): EnhancedInstruction;
  
  analyzeUserIntent(instruction: string): UserIntent;
  formatEnhancedInstruction(instruction: EnhancedInstruction): string;
}

interface EnhancedInstruction {
  originalInstruction: string;
  constraintPrompt: string;
  enhancedInstruction: string;
  metadata: {
    userIntent: UserIntent;
    appliedConstraints: string[];
    confidence: number;
  };
}
```

## ğŸ¯ çº¦æŸæç¤ºè¯æ¨¡æ¿è®¾è®¡

### 1. åŸºç¡€çº¦æŸæ¨¡æ¿ (ä¸­æ–‡)

```
ğŸ”’ æ¥å£å¼€å‘çº¦æŸè¦æ±‚ï¼š

1. **ä¸¥æ ¼éµå¾ªOpenAPI 3.0è§„èŒƒ**
   - æ‰€æœ‰APIç«¯ç‚¹å¿…é¡»ç¬¦åˆç°æœ‰è§„èŒƒ
   - æ–°å¢ç«¯ç‚¹å¿…é¡»éµå¾ªç°æœ‰å‘½åçº¦å®š
   - å¿…é¡»åŒ…å«å®Œæ•´çš„è¯·æ±‚/å“åº”å®šä¹‰

2. **ä»£ç è´¨é‡è¦æ±‚**
   - å¿…é¡»åŒ…å«å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
   - å¿…é¡»å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶
   - å¿…é¡»åŒ…å«è¾“å…¥éªŒè¯å’Œå®‰å…¨æ£€æŸ¥

3. **é¡¹ç›®ä¸Šä¸‹æ–‡çº¦æŸ**
   - APIåŸºç¡€è·¯å¾„: {basePath}
   - è®¤è¯æ–¹å¼: {authMethod}
   - é€šç”¨å“åº”æ ¼å¼: {responseFormat}

4. **æœ€ä½³å®è·µè¦æ±‚**
   - éµå¾ªRESTfulè®¾è®¡åŸåˆ™
   - ä½¿ç”¨æ ‡å‡†HTTPçŠ¶æ€ç 
   - å®ç°é€‚å½“çš„é”™è¯¯å“åº”æ ¼å¼

è¯·åŸºäºä»¥ä¸Šçº¦æŸè¦æ±‚å®Œæˆå¼€å‘ä»»åŠ¡ã€‚
```

### 2. ä¸¥æ ¼çº¦æŸæ¨¡æ¿ (è‹±æ–‡)

```
ğŸ”’ STRICT INTERFACE DEVELOPMENT CONSTRAINTS:

1. **MANDATORY OpenAPI 3.0 Compliance**
   - ALL endpoints MUST conform to existing specifications
   - NEW endpoints MUST follow established naming conventions
   - COMPLETE request/response definitions REQUIRED

2. **CODE QUALITY REQUIREMENTS**
   - COMPLETE TypeScript type definitions MANDATORY
   - PROPER error handling implementation REQUIRED
   - INPUT validation and security checks ESSENTIAL

3. **PROJECT CONTEXT CONSTRAINTS**
   - API Base Path: {basePath}
   - Authentication: {authMethod}
   - Response Format: {responseFormat}

4. **BEST PRACTICES ENFORCEMENT**
   - RESTful design principles MANDATORY
   - Standard HTTP status codes REQUIRED
   - Proper error response format ESSENTIAL

STRICTLY ADHERE to these constraints while completing the development task.
```

## ğŸš€ å·¥ä½œæµç¨‹è®¾è®¡

### 1. æŒ‡ä»¤æ¿€æ´»æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥: ".use interface å¼€å‘èŠå¤©åŠŸèƒ½"
2. InstructionDetector æ£€æµ‹åˆ°çº¦æŸæŒ‡ä»¤
3. ConstraintManager æ¿€æ´»çº¦æŸæ¨¡å¼
4. æå–ç”¨æˆ·æŒ‡ä»¤: "å¼€å‘èŠå¤©åŠŸèƒ½"
5. è¿”å›ç¡®è®¤ä¿¡æ¯å’Œåç»­æŒ‡å¯¼
```

### 2. çº¦æŸåº”ç”¨æµç¨‹

```
1. ç”¨æˆ·è°ƒç”¨ apply-interface-constraints å·¥å…·
2. InstructionEnhancer åˆ†æç”¨æˆ·æ„å›¾
3. ConstraintTemplateEngine ç”Ÿæˆçº¦æŸæç¤ºè¯
4. åˆå¹¶ç”¨æˆ·æŒ‡ä»¤å’Œçº¦æŸæç¤ºè¯
5. è¿”å›å®Œæ•´çš„å¢å¼ºæŒ‡ä»¤
```

### 3. æ™ºèƒ½éªŒè¯æµç¨‹

```
1. ç”¨æˆ·è°ƒç”¨ validate-interface å·¥å…·
2. æ£€æŸ¥æ˜¯å¦å¤„äºçº¦æŸæ¨¡å¼
3. å¦‚æœæ˜¯ï¼Œè‡ªåŠ¨åº”ç”¨çº¦æŸå¢å¼º
4. æ‰§è¡Œæ ‡å‡†éªŒè¯æµç¨‹
5. è¿”å›çº¦æŸæ„ŸçŸ¥çš„éªŒè¯ç»“æœ
```

## ğŸ“Š é…ç½®ç³»ç»Ÿè®¾è®¡

### 1. å…¨å±€é…ç½®

```typescript
interface GlobalConstraintConfig {
  defaultLanguage: 'zh' | 'en' | 'auto';
  defaultTemplateType: 'default' | 'strict' | 'custom';
  enableAutoDetection: boolean;
  maxSessionDuration: number;
  supportedCommands: string[];
}
```

### 2. é¡¹ç›®é…ç½®

```typescript
interface ProjectConstraintConfig {
  apiBasePath: string;
  authenticationMethod: string;
  responseFormat: any;
  customConstraints: string[];
  excludedPaths: string[];
  strictMode: boolean;
}
```

## ğŸ”Œ MCPå·¥å…·æ¥å£è®¾è®¡

### 1. activate-interface-constraints

```json
{
  "name": "activate-interface-constraints",
  "description": "æ¿€æ´»æ¥å£çº¦æŸæ¨¡å¼",
  "inputSchema": {
    "type": "object",
    "properties": {
      "mode": {
        "type": "string",
        "enum": ["activate", "deactivate", "status"],
        "description": "çº¦æŸæ¨¡å¼æ“ä½œ"
      },
      "config": {
        "type": "object",
        "description": "çº¦æŸé…ç½®é€‰é¡¹"
      }
    }
  }
}
```

### 2. apply-interface-constraints

```json
{
  "name": "apply-interface-constraints",
  "description": "åº”ç”¨æ¥å£çº¦æŸåˆ°ç”¨æˆ·æŒ‡ä»¤",
  "inputSchema": {
    "type": "object",
    "properties": {
      "userInstruction": {
        "type": "string",
        "description": "ç”¨æˆ·åŸå§‹æŒ‡ä»¤"
      },
      "constraintType": {
        "type": "string",
        "enum": ["default", "strict", "custom"],
        "description": "çº¦æŸç±»å‹"
      },
      "projectContext": {
        "type": "object",
        "description": "é¡¹ç›®ä¸Šä¸‹æ–‡ä¿¡æ¯"
      }
    },
    "required": ["userInstruction"]
  }
}
```

## ğŸ¯ é¢„æœŸæ•ˆæœ

1. **ç”¨æˆ·ä½“éªŒ**ï¼š
   - ç®€å•çš„ `.use interface` æŒ‡ä»¤å³å¯æ¿€æ´»çº¦æŸ
   - è‡ªåŠ¨ç”Ÿæˆç¬¦åˆè§„èŒƒçš„å¢å¼ºæŒ‡ä»¤
   - æ— éœ€æ‰‹åŠ¨é…ç½®å¤æ‚çš„çº¦æŸè§„åˆ™

2. **ä»£ç è´¨é‡**ï¼š
   - ç¡®ä¿AIç”Ÿæˆçš„ä»£ç ç¬¦åˆOpenAPIè§„èŒƒ
   - è‡ªåŠ¨åŒ…å«ç±»å‹å®‰å…¨å’Œé”™è¯¯å¤„ç†
   - éµå¾ªé¡¹ç›®ç‰¹å®šçš„æ¥å£çº¦å®š

3. **å¼€å‘æ•ˆç‡**ï¼š
   - å‡å°‘æ¥å£ä¸åŒ¹é…çš„é—®é¢˜
   - æä¾›æ™ºèƒ½çš„å¼€å‘æŒ‡å¯¼
   - æ”¯æŒæ¨¡ç³ŠæŒ‡ä»¤çš„ç²¾ç¡®å¤„ç†

è¿™ä¸ªæ¶æ„è®¾è®¡ä¸ºå®ç°æ™ºèƒ½çº¦æŸç³»ç»Ÿæä¾›äº†æ¸…æ™°çš„æŠ€æœ¯è·¯çº¿å›¾ã€‚
